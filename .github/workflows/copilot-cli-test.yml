name: Copilot CLI Test

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  test-copilot-cli:
    runs-on: ubuntu-latest
    steps:
      - name: "Setup Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: "Install GitHub Copilot CLI"
        run: |
          npm install -g @github/copilot
          echo "Copilot CLI installed successfully"

      - name: "Configure GitHub CLI authentication"
        env:
          GH_TOKEN: ${{ secrets.COPILOT_PAT }}
        run: |
          # Authenticate non-interactively using GH_TOKEN
          echo "$GH_TOKEN" | gh auth login --with-token
          gh auth status
          echo "GitHub CLI authenticated successfully"

      - name: "Test Copilot CLI"
        env:
          GH_TOKEN: ${{ secrets.COPILOT_PAT }}
        run: |
          echo "Testing Copilot CLI..."
          copilot -p "echo hello world"
          echo "Copilot CLI test completed successfully!"
