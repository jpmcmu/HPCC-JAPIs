name: Copilot CLI Test

on:
  workflow_dispatch:  # Manual trigger only

jobs:
  test-copilot-cli:
    runs-on: ubuntu-latest
    steps:
      - name: "Setup Node.js"
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: "Install GitHub Copilot CLI"
        run: |
          npm install -g @github/copilot
          echo "Copilot CLI installed successfully"

      - name: "Configure GitHub CLI authentication"
        env:
          GH_TOKEN: ${{ secrets.COPILOT_PAT }}
        run: |
          # Debug: Check if token is set (show only first 4 chars)
          if [ -z "$GH_TOKEN" ]; then
            echo "ERROR: COPILOT_PAT secret is not set!"
            exit 1
          fi
          echo "Token is set (first 4 chars): ${GH_TOKEN:0:4}..."
          
          # Set up git config to avoid prompts
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # Authenticate using the token
          echo "$GH_TOKEN" | gh auth login --with-token --hostname github.com
          
          # Verify authentication
          gh auth status
          echo "GitHub CLI authenticated successfully"

      - name: "Test Copilot CLI"
        env:
          GH_TOKEN: ${{ secrets.COPILOT_PAT }}
        run: |
          echo "Testing Copilot CLI..."
          copilot -p "echo hello world"
          echo "Copilot CLI test completed successfully!"
